<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breeze - Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/windows-dialog.css">
</head>
<body>
    <div class="dashboard">
        <nav class="top-nav">
            <img src="logobreeze.png" alt="Breeze Logo" class="logo-nav">
            <div class="nav-right">
                <div class="user-info">
                    <div class="user-avatar" id="navAvatar">TB</div>
                    <span id="navUserName">Test Bruger</span>
                </div>
                <button class="logout-btn" onclick="logout()">Log ud</button>
            </div>
        </nav>

        <div class="main-content">
            <aside class="sidebar">
                <h3>Menu</h3>
                <div class="menu-item" onclick="showPage('feed')">üì∞ Feed</div>
                <div class="menu-item" onclick="showPage('profile')">üìä Min Profil</div>
                <div class="menu-item" onclick="showPage('files')">üìÅ Filer</div>
                <div class="menu-item" onclick="showPage('chat')">üí¨ Chat</div>
                <div class="menu-item" onclick="showPage('videocall')">üìû Videoopkald</div>
                <div class="menu-item" onclick="showPage('colleagues')">üë• Kolleger</div>
                <div class="menu-item" onclick="showPage('settings')">‚öôÔ∏è Indstillinger</div>
                <div class="menu-item" id="adminMenuItem" onclick="showPage('admin')" style="display: none;">üõ°Ô∏è Admin Panel</div>
            </aside>

            <main class="content-area">
                <!-- FEED SIDE -->
                <div id="feedPage" class="page-content">
                    <h2 style="margin-bottom: 20px;">FlowFactory's Feed</h2>
                    
                    <div class="create-post">
                        <div style="display: flex; gap: 15px; align-items: flex-start;">
                            <div class="user-avatar" id="feedAvatar">TB</div>
                            <div style="flex: 1;">
                                <textarea id="postContent" placeholder="Hvad vil du dele med dine kolleger?" rows="3"></textarea>
                                
                                <div id="filePreview" style="margin-top: 10px;"></div>
                                
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button onclick="addPost()" class="post-btn">Del opslag</button>
                                    <button class="attach-btn" onclick="document.getElementById('imageInput').click()">üì∑ Billede</button>
                                    <button class="attach-btn" onclick="document.getElementById('fileInput').click()">üìé Fil</button>
                                </div>
                                
                                <input type="file" id="imageInput" accept="image/*,video/*" style="display: none;" onchange="handleImageUpload(event)">
                                <input type="file" id="fileInput" style="display: none;" onchange="handleFileUpload(event)">
                            </div>
                        </div>
                    </div>

                    <div id="feedPosts"></div>
                </div>

                <!-- PROFIL SIDE -->
                <div id="profilePage" class="page-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Min Profil</h2>

                    <div class="profile-header">
                        <div style="position: relative;">
                            <div class="profile-avatar" id="profileAvatar">TB</div>
                            <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="changeProfilePhoto(event)">
                            <button class="change-photo-btn" onclick="document.getElementById('profilePhotoInput').click()">üì∑</button>
                        </div>
                        
                        <div class="profile-info">
                            <h2 id="profileName">Test Bruger</h2>
                            <p id="profileEmail">test@firma.dk</p>
                        </div>
                        
                        <button id="editBtn" class="edit-profile-btn" onclick="toggleEditMode()">‚úèÔ∏è Rediger profil</button>
                    </div>

                    <div id="profileViewMode">
                        <div class="info-card">
                            <h3>Personlige oplysninger</h3>
                            <div class="info-row">
                                <div class="info-label">Fulde navn:</div>
                                <div class="info-value" id="infoName">Test Bruger</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Email:</div>
                                <div class="info-value" id="infoEmail">test@firma.dk</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Stilling:</div>
                                <div class="info-value" id="infoPosition">Medarbejder</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Afdeling:</div>
                                <div class="info-value" id="infoDepartment">IT</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Telefon:</div>
                                <div class="info-value" id="infoPhone">+45 12 34 56 78</div>
                            </div>
                        </div>

                        <div class="info-card">
                            <h3>Aktivitet</h3>
                            <div class="info-row">
                                <div class="info-label">Medlem siden:</div>
                                <div class="info-value" id="infoMemberSince">Indl√¶ser...</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Beskeder sendt:</div>
                                <div class="info-value" id="infoMessagesSent">Indl√¶ser...</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Opslag lavet:</div>
                                <div class="info-value" id="infoPostsCreated">Indl√¶ser...</div>
                            </div>
                        </div>
                    </div>

                    <div id="profileEditMode" style="display: none;">
                        <div class="info-card">
                            <h3>Rediger Information</h3>
                            <div class="edit-form">
                                <div class="form-group">
                                    <label>Fulde navn:</label>
                                    <input type="text" id="editName" class="profile-input">
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" id="editEmail" class="profile-input" disabled>
                                </div>
                                <div class="form-group">
                                    <label>Stilling:</label>
                                    <input type="text" id="editPosition" class="profile-input">
                                </div>
                                <div class="form-group">
                                    <label>Afdeling:</label>
                                    <input type="text" id="editDepartment" class="profile-input">
                                </div>
                                <div class="form-group">
                                    <label>Telefon:</label>
                                    <input type="tel" id="editPhone" class="profile-input">
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 20px;">
                                    <button class="save-btn" onclick="saveProfile()">ÔøΩ Gem √¶ndringer</button>
                                    <button class="cancel-btn" onclick="toggleEditMode()">‚ùå Annuller</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FILER SIDE -->
                <div id="filesPage" class="page-content" style="display: none;">
                    <div class="file-explorer">
                        <div class="explorer-title-bar">
                            <span>üìÅ Filh√•ndtering</span>
                        </div>


                        <div class="explorer-toolbar">
                            <div class="toolbar-left">
                                <button class="toolbar-btn" onclick="navigateBack()" title="Tilbage">‚óÄ Tilbage</button>
                                <button class="toolbar-btn" onclick="navigateUp()" title="Op">‚¨Ü</button>
                            </div>
                            <div class="toolbar-center">
                                <span class="address-bar-label">Adresse:</span>
                                <div class="address-bar" id="addressBar">C:\Mine dokumenter</div>
                            </div>
                            <div class="toolbar-right">
                                <button class="toolbar-btn" onclick="showNewFolderDialog()">üìÅ Ny</button>
                                <button class="toolbar-btn" onclick="document.getElementById('fileExplorerUpload').click()">üì§ Upload</button>
                                <button class="toolbar-btn" onclick="downloadFile()">üíæ Download</button>
                                <button class="toolbar-btn" onclick="deleteSelected()">üóëÔ∏è Slet</button>
                                <button class="toolbar-btn" onclick="searchFiles()">üîç S√∏g</button>
                                <button class="toolbar-btn" onclick="refreshExplorer()">üîÑ</button>
                                <input type="file" id="fileExplorerUpload" style="display: none;" onchange="uploadFileToExplorer(event)">
                            </div>
                        </div>

                        <div class="explorer-body">
                            <div class="explorer-tree" id="folderTree"></div>

                            <div class="explorer-content">
                                <table class="file-list-view">
                                    <thead>
                                        <tr>
                                            <th onclick="sortFiles('name')">Navn</th>
                                            <th onclick="sortFiles('size')" style="width: 100px;">St√∏rrelse</th>
                                            <th onclick="sortFiles('type')" style="width: 120px;">Type</th>
                                            <th onclick="sortFiles('date')" style="width: 140px;">√Ündret</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fileListBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="explorer-statusbar">
                            <span class="status-section" id="fileCount">0 objekter</span>
                            <span class="status-section" id="selectedInfo"></span>
                        </div>
                    </div>

                    <div id="contextMenu" class="context-menu">
                        <div class="context-menu-item" onclick="openSelectedFile()">√Öbn</div>
                        <div class="context-menu-separator"></div>
                        <div class="context-menu-item" onclick="cutSelected()">Klip</div>
                        <div class="context-menu-item" onclick="copySelected()">Kopier</div>
                        <div class="context-menu-item" onclick="pasteClipboard()">S√¶t ind</div>
                        <div class="context-menu-separator"></div>
                        <div class="context-menu-item" onclick="downloadFile()">üíæ Download</div>
                        <div class="context-menu-item" onclick="shareFile()">üîó Del med kolleger</div>
                        <div class="context-menu-separator"></div>
                        <div class="context-menu-item" onclick="deleteSelected()">Slet</div>
                        <div class="context-menu-item" onclick="renameSelected()">Omd√∏b</div>
                        <div class="context-menu-separator"></div>
                        <div class="context-menu-item" onclick="showProperties()">Egenskaber</div>
                    </div>
                </div>

                <!-- CHAT SIDE -->
                <div id="chatPage" class="page-content" style="display: none;">
                    <div class="chat-container">
                        <div class="chat-users">
                            <h3>Medarbejdere</h3>
                            <div class="user-search">
                                <input type="text" placeholder="üîç S√∏g..." id="userSearch" onkeyup="filterUsers()">
                            </div>
                            <div id="userList"></div>
                        </div>

                        <div class="chat-main">
                            <div class="no-chat-selected" id="noChatSelected">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 60px;">üí¨</div>
                                    <h3>V√¶lg en medarbejder</h3>
                                    <p>V√¶lg en person fra listen for at starte en chat</p>
                                </div>
                            </div>

                            <div class="chat-active" id="chatActive" style="display: none;">
                                <div class="chat-header">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div class="user-avatar-small" id="chatUserAvatar">AB</div>
                                        <div>
                                            <div class="chat-user-name" id="chatUserName">Anders Berg</div>
                                            <div class="chat-user-status" id="chatUserStatus">Online</div>
                                        </div>
                                    </div>
                                    <button class="close-chat-btn" onclick="closeChat()">‚úï</button>
                                </div>

                                <div class="chat-messages" id="chatMessages"></div>

                                <div class="chat-input-area">
                                    <button class="emoji-btn" onclick="toggleEmojiPicker()">üòä</button>
                                    <input type="text" id="chatInput" placeholder="Skriv en besked..." onkeypress="if(event.key==='Enter') sendMessage()">
                                    <button class="send-btn" onclick="sendMessage()">Send</button>
                                </div>

                                <div class="emoji-picker" id="emojiPicker" style="display: none;">
                                    <div class="emoji-grid">
                                        <span class="emoji-item" onclick="insertEmoji('üòä')">üòä</span>
                                        <span class="emoji-item" onclick="insertEmoji('üòÇ')">üòÇ</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëç')">üëç</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëé')">üëé</span>
                                        <span class="emoji-item" onclick="insertEmoji('üî•')">üî•</span>
                                        <span class="emoji-item" onclick="insertEmoji('üéâ')">üéâ</span>
                                        <span class="emoji-item" onclick="insertEmoji('üòé')">üòé</span>
                                        <span class="emoji-item" onclick="insertEmoji('ü§î')">ü§î</span>
                                        <span class="emoji-item" onclick="insertEmoji('üò¢')">üò¢</span>
                                        <span class="emoji-item" onclick="insertEmoji('üò°')">üò°</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëã')">üëã</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚úÖ')">‚úÖ</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚ùå')">‚ùå</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚ö†Ô∏è')">‚ö†Ô∏è</span>
                                        <span class="emoji-item" onclick="insertEmoji('üí™')">üí™</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KOLLEGER SIDE -->
                <div id="colleaguesPage" class="page-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">Kolleger</h2>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
                        <input type="text" id="colleagueSearch" placeholder="üîç S√∏g efter kolleger..." 
                               style="flex: 1; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;"
                               onkeyup="filterColleagues()">
                        
                        <select id="departmentFilter" onchange="filterColleagues()" 
                                style="padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                            <option value="">Alle afdelinger</option>
                        </select>
                        
                        <select id="positionFilter" onchange="filterColleagues()" 
                                style="padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                            <option value="">Alle stillinger</option>
                        </select>
                    </div>

                    <div id="colleaguesGrid" class="colleagues-grid"></div>
                </div>

                <!-- VIDEOOPKALD SIDE -->
                <div id="videocallPage" class="page-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">üìû Videoopkald</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px; height: 700px;">
                        <!-- Video omr√•de -->
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- Hovedvideo (den du ringer til) -->
                            <div id="mainVideo" style="flex: 1; background: #000; border-radius: 10px; position: relative; display: flex; align-items: center; justify-content: center;">
                                <div id="callPlaceholder" style="text-align: center; color: white;">
                                    <div style="font-size: 80px; margin-bottom: 20px;">üìπ</div>
                                    <h3>V√¶lg en kollega for at starte videoopkald</h3>
                                    <p style="margin-top: 10px; opacity: 0.7;">Klik p√• en kollega i listen til h√∏jre</p>
                                </div>
                                
                                <!-- Dit eget lille video -->
                                <div id="localVideo" style="position: absolute; bottom: 20px; right: 20px; width: 200px; height: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: none; align-items: center; justify-content: center; color: white; font-size: 40px; border: 3px solid white;">
                                    DU
                                </div>
                            </div>
                            
                            <!-- Kontroller -->
                            <div id="callControls" style="display: none; background: white; padding: 20px; border-radius: 10px; justify-content: center; align-items: center; gap: 15px;">
                                <button onclick="toggleMicrophone()" id="micBtn" style="padding: 15px 25px; background: #4caf50; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 16px;">
                                    üé§ Mikrofon
                                </button>
                                <button onclick="toggleCamera()" id="camBtn" style="padding: 15px 25px; background: #2196f3; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 16px;">
                                    üìπ Kamera
                                </button>
                                <button onclick="endCall()" style="padding: 15px 40px; background: #f44336; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 16px; font-weight: bold;">
                                    ‚ùå Afslut opkald
                                </button>
                                <button onclick="shareScreen()" style="padding: 15px 25px; background: #9c27b0; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 16px;">
                                    üñ•Ô∏è Del sk√¶rm
                                </button>
                            </div>
                        </div>
                        
                        <!-- Kollega liste -->
                        <div style="background: white; border-radius: 10px; padding: 20px; overflow-y: auto;">
                            <h3 style="margin-bottom: 15px;">Tilg√¶ngelige kolleger</h3>
                            <div id="videoCallColleagues"></div>
                        </div>
                    </div>
                </div>

                <!-- ADMIN SIDE -->
                <div id="adminPage" class="page-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">üõ°Ô∏è Admin Panel</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px;">
                            <h3 style="margin: 0 0 10px 0;">üìä Statistik</h3>
                            <p style="font-size: 32px; font-weight: bold; margin: 0;" id="adminTotalUsers">-</p>
                            <p style="margin: 5px 0 0 0; opacity: 0.9;">Totale brugere</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px;">
                            <h3 style="margin: 0 0 10px 0;">‚è≥ Afventende</h3>
                            <p style="font-size: 32px; font-weight: bold; margin: 0;" id="adminPendingUsers">-</p>
                            <p style="margin: 5px 0 0 0; opacity: 0.9;">Godkendelser</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 10px;">
                            <h3 style="margin: 0 0 10px 0;">üé´ Invite Koder</h3>
                            <p style="font-size: 32px; font-weight: bold; margin: 0;" id="adminInviteCodes">-</p>
                            <p style="margin: 5px 0 0 0; opacity: 0.9;">Aktive koder</p>
                        </div>
                    </div>

                    <!-- Ventende Brugere -->
                    <div class="info-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0;">‚è≥ Ventende Registreringer</h3>
                            <button onclick="loadPendingUsers()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                üîÑ Opdater
                            </button>
                        </div>
                        <div id="pendingUsersList"></div>
                    </div>

                    <!-- Invite Koder -->
                    <div class="info-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0;">üé´ Invite Koder</h3>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="sendEmailInvitation()" style="padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    üìß Send Email Invitation
                                </button>
                                <button onclick="generateInviteCode()" style="padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    ‚ûï Generer Ny Kode
                                </button>
                            </div>
                        </div>
                        <div id="inviteCodesList"></div>
                    </div>

                    <!-- Alle Brugere -->
                    <div class="info-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0;">üë• Alle Brugere</h3>
                            <button onclick="loadAllUsers()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                üîÑ Opdater
                            </button>
                        </div>
                        <div id="allUsersList"></div>
                    </div>
                </div>

                <!-- INDSTILLINGER SIDE -->
                <div id="settingsPage" class="page-content" style="display: none;">
                    <h2 style="margin-bottom: 20px;">‚öôÔ∏è Indstillinger</h2>
                    
                    <div class="info-card">
                        <h3>üì¢ Notifikationer</h3>
                        <div style="padding: 15px 0;">
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                <input type="checkbox" id="notifPosts" checked style="width: 18px; height: 18px;">
                                <span>F√• besked n√•r nogen laver et nyt opslag</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                <input type="checkbox" id="notifMessages" checked style="width: 18px; height: 18px;">
                                <span>F√• besked ved nye chat beskeder</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="notifFiles" checked style="width: 18px; height: 18px;">
                                <span>F√• besked n√•r filer deles med dig</span>
                            </label>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>üåô Udseende</h3>
                        <div style="padding: 15px 0;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">V√¶lg tema:</label>
                            <select id="themeSelect" onchange="changeTheme(this.value)" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px; font-size: 14px;">
                                <option value="light" selected>‚òÄÔ∏è Lyst tema</option>
                                <option value="dark">üåô M√∏rkt tema</option>
                                <option value="auto">üîÑ Automatisk (f√∏lg system)</option>
                            </select>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>üîí Privatliv & Sikkerhed</h3>
                        <div style="padding: 15px 0;">
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                <input type="checkbox" id="showOnlineStatus" checked style="width: 18px; height: 18px;">
                                <span>Vis min online status til kolleger</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                <input type="checkbox" id="showEmail" checked style="width: 18px; height: 18px;">
                                <span>Vis min email til kolleger</span>
                            </label>
                            <button onclick="changePassword()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                                üîê Skift adgangskode
                            </button>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>üì± Applikation</h3>
                        <div style="padding: 15px 0;">
                            <div style="margin-bottom: 15px;">
                                <strong>Version:</strong> 1.0.0
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Sidst opdateret:</strong> 09/10/2025
                            </div>
                            <button onclick="clearCache()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                üóëÔ∏è Ryd cache
                            </button>
                            <button onclick="exportData()" style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                üì• Eksporter mine data
                            </button>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>‚ÑπÔ∏è Om FlowFactory Portal</h3>
                        <div style="padding: 15px 0; line-height: 1.8;">
                            <p>FlowFactory Virksomhedsportal er udviklet til at forbinde medarbejdere og forbedre samarbejdet.</p>
                            <p style="margin-top: 10px;">
                                <strong>Support:</strong> <a href="mailto:support@flowfactory.dk" style="color: #667eea;">support@flowfactory.dk</a>
                            </p>
                            <p style="margin-top: 5px;">
                                <strong>Dokumentation:</strong> <a href="#" style="color: #667eea;">L√¶s brugervejledningen</a>
                            </p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img id="modalImage" src="" alt="">
    </div>

    <!-- Windows Style Dialog -->
    <div class="windows-dialog-overlay" id="windowsDialogOverlay"></div>
    <div class="windows-dialog" id="windowsDialog">
        <div class="windows-dialog-title">
            <span id="windowsDialogTitle">Besked</span>
            <button class="windows-dialog-close" onclick="closeWindowsDialog()">√ó</button>
        </div>
        <div class="windows-dialog-content">
            <div class="windows-dialog-icon" id="windowsDialogIcon">‚ÑπÔ∏è</div>
            <div class="windows-dialog-text" id="windowsDialogText"></div>
        </div>
        <div class="windows-dialog-buttons" id="windowsDialogButtons"></div>
    </div>

    <script src="js/feed.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/files-real.js"></script>
    <script src="js/colleagues.js"></script>
    <script src="js/theme.js"></script>
    <script>
        // Windows Style Dialog Functions
        function showWindowsDialog(title, message, icon, buttons) {
            return new Promise((resolve) => {
                const dialog = document.getElementById('windowsDialog');
                const overlay = document.getElementById('windowsDialogOverlay');
                const dialogTitle = document.getElementById('windowsDialogTitle');
                const dialogIcon = document.getElementById('windowsDialogIcon');
                const dialogText = document.getElementById('windowsDialogText');
                const dialogButtons = document.getElementById('windowsDialogButtons');
                
                dialogTitle.textContent = title;
                dialogIcon.textContent = icon;
                dialogText.innerHTML = message.replace(/\n/g, '<br>');
                
                dialogButtons.innerHTML = '';
                buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'windows-btn';
                    button.textContent = btn.text;
                    button.onclick = () => {
                        closeWindowsDialog();
                        resolve(btn.value);
                    };
                    dialogButtons.appendChild(button);
                });
                
                overlay.style.display = 'block';
                dialog.style.display = 'block';
                
                // Focus first button
                setTimeout(() => {
                    const firstBtn = dialogButtons.querySelector('.windows-btn');
                    if (firstBtn) firstBtn.focus();
                }, 100);
            });
        }
        
        function closeWindowsDialog() {
            document.getElementById('windowsDialog').style.display = 'none';
            document.getElementById('windowsDialogOverlay').style.display = 'none';
        }
        
        // Windows-style alert
        window.winAlert = function(message, title = 'Besked') {
            return showWindowsDialog(title, message, '‚ÑπÔ∏è', [
                { text: 'OK', value: true }
            ]);
        };
        
        // Windows-style confirm
        window.winConfirm = function(message, title = 'Bekr√¶ft') {
            return showWindowsDialog(title, message, '‚ùì', [
                { text: 'Ja', value: true },
                { text: 'Nej', value: false }
            ]);
        };
        
        // Windows-style prompt
        window.winPrompt = function(message, defaultValue = '', title = 'Indtast') {
            return new Promise((resolve) => {
                const dialog = document.getElementById('windowsDialog');
                const overlay = document.getElementById('windowsDialogOverlay');
                const dialogTitle = document.getElementById('windowsDialogTitle');
                const dialogIcon = document.getElementById('windowsDialogIcon');
                const dialogText = document.getElementById('windowsDialogText');
                const dialogButtons = document.getElementById('windowsDialogButtons');
                
                dialogTitle.textContent = title;
                dialogIcon.textContent = '‚úèÔ∏è';
                dialogText.innerHTML = message.replace(/\n/g, '<br>') + 
                    '<input type="text" class="windows-dialog-input" id="windowsPromptInput" value="' + defaultValue + '">';
                
                dialogButtons.innerHTML = '';
                
                const okBtn = document.createElement('button');
                okBtn.className = 'windows-btn';
                okBtn.textContent = 'OK';
                okBtn.onclick = () => {
                    const value = document.getElementById('windowsPromptInput').value;
                    closeWindowsDialog();
                    resolve(value);
                };
                dialogButtons.appendChild(okBtn);
                
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'windows-btn';
                cancelBtn.textContent = 'Annuller';
                cancelBtn.onclick = () => {
                    closeWindowsDialog();
                    resolve(null);
                };
                dialogButtons.appendChild(cancelBtn);
                
                overlay.style.display = 'block';
                dialog.style.display = 'block';
                
                // Focus input
                setTimeout(() => {
                    const input = document.getElementById('windowsPromptInput');
                    if (input) {
                        input.focus();
                        input.select();
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') okBtn.click();
                        });
                    }
                }, 100);
            });
        };
    </script>
    <script>
        window.onload = function() {
            loadUserData();
            showPage('feed');
            initChat();
        };

        function loadUserData() {
            const userData = sessionStorage.getItem('currentUser');
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }

            const currentUser = JSON.parse(userData);
            const initials = currentUser.name.split(' ').map(n => n[0]).join('');

            if (currentUser.profilePhoto) {
                document.getElementById('navAvatar').style.backgroundImage = `url(${currentUser.profilePhoto})`;
                document.getElementById('navAvatar').style.backgroundSize = 'cover';
                document.getElementById('navAvatar').textContent = '';
                
                document.getElementById('profileAvatar').style.backgroundImage = `url(${currentUser.profilePhoto})`;
                document.getElementById('profileAvatar').style.backgroundSize = 'cover';
                document.getElementById('profileAvatar').textContent = '';
                
                document.getElementById('feedAvatar').style.backgroundImage = `url(${currentUser.profilePhoto})`;
                document.getElementById('feedAvatar').style.backgroundSize = 'cover';
                document.getElementById('feedAvatar').textContent = '';
            } else {
                document.getElementById('navAvatar').textContent = initials;
                document.getElementById('profileAvatar').textContent = initials;
                document.getElementById('feedAvatar').textContent = initials;
            }

            document.getElementById('navUserName').textContent = currentUser.name;
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('infoName').textContent = currentUser.name;
            document.getElementById('infoEmail').textContent = currentUser.email;
            document.getElementById('infoPosition').textContent = currentUser.position || 'Ikke angivet';
            document.getElementById('infoDepartment').textContent = currentUser.department || 'Ikke angivet';
            document.getElementById('infoPhone').textContent = currentUser.phone || 'Ikke angivet';

            window.currentUser = currentUser;
            
            // Load user activity
            loadUserActivity();
        }

        async function loadUserActivity() {
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/users/activity', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to load activity');
                
                const data = await response.json();
                
                // Format member since date
                const memberDate = new Date(data.member_since);
                const now = new Date();
                const diffTime = Math.abs(now - memberDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let memberText;
                if (diffDays < 30) {
                    memberText = `${diffDays} dage`;
                } else if (diffDays < 365) {
                    const months = Math.floor(diffDays / 30);
                    memberText = `${months} m√•ned${months > 1 ? 'er' : ''}`;
                } else {
                    const years = Math.floor(diffDays / 365);
                    memberText = `${years} √•r`;
                }
                
                document.getElementById('infoMemberSince').textContent = memberText;
                document.getElementById('infoMessagesSent').textContent = data.messages_sent;
                document.getElementById('infoPostsCreated').textContent = data.posts_created;
                
            } catch (error) {
                console.error('Error loading activity:', error);
                document.getElementById('infoMemberSince').textContent = 'Fejl';
                document.getElementById('infoMessagesSent').textContent = 'Fejl';
                document.getElementById('infoPostsCreated').textContent = 'Fejl';
            }
        }

        function logout() {
            sessionStorage.removeItem('currentUser');
            sessionStorage.removeItem('token');
            window.location.href = 'index.html';
        }

        function showPage(pageName) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });

            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            if (pageName === 'feed') {
                document.getElementById('feedPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[0].classList.add('active');
            } else if (pageName === 'profile') {
                document.getElementById('profilePage').style.display = 'block';
                document.querySelectorAll('.menu-item')[1].classList.add('active');
            } else if (pageName === 'files') {
                document.getElementById('filesPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[2].classList.add('active');
                loadRealFiles();
            } else if (pageName === 'chat') {
                document.getElementById('chatPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[3].classList.add('active');
            } else if (pageName === 'videocall') {
                document.getElementById('videocallPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[4].classList.add('active');
                loadVideoCallColleagues();
            } else if (pageName === 'colleagues') {
                document.getElementById('colleaguesPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[5].classList.add('active');
                loadColleagues();
            } else if (pageName === 'settings') {
                document.getElementById('settingsPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[6].classList.add('active');
            } else if (pageName === 'admin') {
                document.getElementById('adminPage').style.display = 'block';
                document.querySelectorAll('.menu-item')[7].classList.add('active');
                loadPendingUsers();
                loadInviteCodes();
                loadAllUsers();
            }
        }

        // Indstillinger funktioner
        function changePassword() {
            const oldPassword = prompt('Indtast nuv√¶rende adgangskode:');
            if (!oldPassword) return;
            
            const newPassword = prompt('Indtast ny adgangskode:');
            if (!newPassword) return;
            
            const confirmPassword = prompt('Bekr√¶ft ny adgangskode:');
            if (newPassword !== confirmPassword) {
                alert('‚ùå Adgangskoderne matcher ikke!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('‚ùå Adgangskoden skal v√¶re mindst 6 tegn lang!');
                return;
            }
            
            // Her ville vi normalt sende til backend
            alert('‚úÖ Adgangskode √¶ndret succesfuldt!\n\n(I en rigtig app ville dette opdatere din adgangskode i databasen)');
        }

        function clearCache() {
            if (confirm('Er du sikker p√• at du vil rydde cache?\n\nDette vil slette alle midlertidige filer og du bliver logget ud.')) {
                sessionStorage.clear();
                localStorage.clear();
                alert('‚úÖ Cache ryddet! Du bliver nu logget ud.');
                window.location.href = 'index.html';
            }
        }

        function exportData() {
            const userData = {
                user: window.currentUser,
                exportDate: new Date().toISOString(),
                version: '1.0.0'
            };
            
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `flowfactory-data-${window.currentUser.name.replace(/\s+/g, '-')}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Dine data er blevet eksporteret!');
        }

        function toggleEditMode() {
            const viewMode = document.getElementById('profileViewMode');
            const editMode = document.getElementById('profileEditMode');
            const editBtn = document.getElementById('editBtn');
            
            if (editMode.style.display === 'none') {
                document.getElementById('editName').value = window.currentUser.name;
                document.getElementById('editEmail').value = window.currentUser.email;
                document.getElementById('editPosition').value = window.currentUser.position || '';
                document.getElementById('editDepartment').value = window.currentUser.department || '';
                document.getElementById('editPhone').value = window.currentUser.phone || '';
                
                viewMode.style.display = 'none';
                editMode.style.display = 'block';
                editBtn.textContent = '‚ùå Annuller';
            } else {
                viewMode.style.display = 'block';
                editMode.style.display = 'none';
                editBtn.textContent = '‚úèÔ∏è Rediger profil';
            }
        }

async function saveProfile() {
    const newName = document.getElementById('editName').value.trim();
    const newPosition = document.getElementById('editPosition').value.trim();
    const newDepartment = document.getElementById('editDepartment').value.trim();
    const newPhone = document.getElementById('editPhone').value.trim();
    
    if (!newName) {
        alert('Navn kan ikke v√¶re tomt');
        return;
    }

    try {
        const token = sessionStorage.getItem('token');
        const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/users/me', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                name: newName,
                position: newPosition,
                department: newDepartment,
                phone: newPhone
            })
        });

        if (!response.ok) {
            const error = await response.json().catch(() => ({ error: 'Ukendt fejl' }));
            throw new Error(error.error || 'Kunne ikke opdatere profil');
        }

        const { user } = await response.json();
        
        // Opdater lokal bruger data
        window.currentUser.name = user.name;
        window.currentUser.position = user.position;
        window.currentUser.department = user.department;
        window.currentUser.phone = user.phone;
        sessionStorage.setItem('currentUser', JSON.stringify(window.currentUser));
        
        const initials = newName.split(' ').map(n => n[0]).join('');
        
        if (!window.currentUser.profilePhoto) {
            document.getElementById('navAvatar').textContent = initials;
            document.getElementById('profileAvatar').textContent = initials;
            document.getElementById('feedAvatar').textContent = initials;
        }
        
        document.getElementById('navUserName').textContent = newName;
        document.getElementById('profileName').textContent = newName;
        document.getElementById('infoName').textContent = newName;
        document.getElementById('infoPosition').textContent = newPosition || 'Ikke angivet';
        document.getElementById('infoDepartment').textContent = newDepartment || 'Ikke angivet';
        document.getElementById('infoPhone').textContent = newPhone || 'Ikke angivet';
        
        toggleEditMode();
        alert('Profil opdateret! ‚úÖ');
    } catch (error) {
        console.error('Profil opdatering fejl:', error);
        alert('Fejl ved opdatering: ' + error.message);
    }
}

        function changeProfilePhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                window.currentUser.profilePhoto = e.target.result;
                sessionStorage.setItem('currentUser', JSON.stringify(window.currentUser));
                
                document.getElementById('navAvatar').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('navAvatar').style.backgroundSize = 'cover';
                document.getElementById('navAvatar').textContent = '';
                
                document.getElementById('profileAvatar').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('profileAvatar').style.backgroundSize = 'cover';
                document.getElementById('profileAvatar').textContent = '';
                
                document.getElementById('feedAvatar').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('feedAvatar').style.backgroundSize = 'cover';
                document.getElementById('feedAvatar').textContent = '';
            };
            reader.readAsDataURL(file);
        }

        // Videoopkald funktioner
        let currentCall = null;
        let microphoneEnabled = true;
        let cameraEnabled = true;

        function loadVideoCallColleagues() {
            const colleagues = [
                { id: 2, name: 'Anders Berg', status: 'online' },
                { id: 3, name: 'Mette Hansen', status: 'online' },
                { id: 4, name: 'Peter Nielsen', status: 'busy' },
                { id: 5, name: 'Sofia Larsen', status: 'online' },
                { id: 6, name: 'Thomas Jensen', status: 'offline' },
                { id: 7, name: 'Emma Christensen', status: 'online' },
                { id: 8, name: 'Oliver Andersen', status: 'online' }
            ];

            const container = document.getElementById('videoCallColleagues');
            container.innerHTML = colleagues.map(colleague => {
                const initials = colleague.name.split(' ').map(n => n[0]).join('');
                const statusColor = colleague.status === 'online' ? '#4caf50' : colleague.status === 'busy' ? '#f44336' : '#999';
                const statusText = colleague.status === 'online' ? 'Online' : colleague.status === 'busy' ? 'Optaget' : 'Offline';
                
                return `
                    <div onclick="startVideoCall(${colleague.id}, '${colleague.name}')" style="padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; position: relative;">
                                ${initials}
                                <div style="position: absolute; bottom: 0; right: 0; width: 14px; height: 14px; border-radius: 50%; background: ${statusColor}; border: 2px solid white;"></div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #333;">${colleague.name}</div>
                                <div style="font-size: 12px; color: ${statusColor};">${statusText}</div>
                            </div>
                            <div style="font-size: 24px;">üìû</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function startVideoCall(colleagueId, colleagueName) {
            if (currentCall) {
                alert('Du er allerede i et opkald!');
                return;
            }

            currentCall = { id: colleagueId, name: colleagueName };
            
            // Skjul placeholder, vis video og kontroller
            document.getElementById('callPlaceholder').style.display = 'none';
            document.getElementById('localVideo').style.display = 'flex';
            document.getElementById('callControls').style.display = 'flex';
            
            // Vis modtagers video (simuleret)
            const initials = colleagueName.split(' ').map(n => n[0]).join('');
            document.getElementById('mainVideo').innerHTML = `
                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 120px; font-weight: bold;">
                    ${initials}
                </div>
                <div style="position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.7); padding: 15px 25px; border-radius: 10px; color: white;">
                    <h3 style="margin: 0;">I opkald med ${colleagueName}</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.8;">Forbundet ‚Ä¢ God kvalitet</p>
                </div>
                <div id="localVideo" style="position: absolute; bottom: 20px; right: 20px; width: 200px; height: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; border: 3px solid white;">
                    DU
                </div>
            `;
            
            // Simuler ring tone
            alert(`üìû Ringer til ${colleagueName}...\n\n‚úÖ Forbundet!`);
        }

        function toggleMicrophone() {
            microphoneEnabled = !microphoneEnabled;
            const btn = document.getElementById('micBtn');
            if (microphoneEnabled) {
                btn.style.background = '#4caf50';
                btn.innerHTML = 'üé§ Mikrofon';
            } else {
                btn.style.background = '#f44336';
                btn.innerHTML = 'üé§ Mikrofon (Slukket)';
            }
        }

        function toggleCamera() {
            cameraEnabled = !cameraEnabled;
            const btn = document.getElementById('camBtn');
            if (cameraEnabled) {
                btn.style.background = '#2196f3';
                btn.innerHTML = 'üìπ Kamera';
                document.getElementById('localVideo').innerHTML = 'DU';
            } else {
                btn.style.background = '#f44336';
                btn.innerHTML = 'üìπ Kamera (Slukket)';
                document.getElementById('localVideo').innerHTML = 'üìπ <div style="font-size: 16px; margin-top: 10px;">Kamera slukket</div>';
            }
        }

        function shareScreen() {
            alert('üñ•Ô∏è Sk√¶rmdeling startet!\n\nDu deler nu din sk√¶rm med ' + (currentCall ? currentCall.name : 'kollega') + '\n\n(Dette er en demo - i en rigtig app ville du dele din sk√¶rm via WebRTC)');
        }

        function endCall() {
            if (!currentCall) return;
            
            const calleeName = currentCall.name;
            currentCall = null;
            microphoneEnabled = true;
            cameraEnabled = true;
            
            // Reset UI
            document.getElementById('mainVideo').innerHTML = `
                <div id="callPlaceholder" style="text-align: center; color: white;">
                    <div style="font-size: 80px; margin-bottom: 20px;">üìπ</div>
                    <h3>V√¶lg en kollega for at starte videoopkald</h3>
                    <p style="margin-top: 10px; opacity: 0.7;">Klik p√• en kollega i listen til h√∏jre</p>
                </div>
            `;
            document.getElementById('callControls').style.display = 'none';
            
            alert(`üìû Opkald afsluttet med ${calleeName}`);
        }

        // Admin funktioner
        async function loadAdminData() {
            if (!window.currentUser.is_admin) {
                document.getElementById('adminMenuItem').style.display = 'none';
                return;
            }
            
            document.getElementById('adminMenuItem').style.display = 'block';
            
            try {
                const token = sessionStorage.getItem('token');
                
                // Load stats
                const usersRes = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const users = await usersRes.json();
                document.getElementById('adminTotalUsers').textContent = users.length;
                
                const pendingRes = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/pending-users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const pending = await pendingRes.json();
                document.getElementById('adminPendingUsers').textContent = pending.length;
                
                const codesRes = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/invite-codes', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const codes = await codesRes.json();
                const activeCodes = codes.filter(c => !c.used_by && new Date(c.expires_at) > new Date());
                document.getElementById('adminInviteCodes').textContent = activeCodes.length;
                
            } catch (error) {
                console.error('Failed to load admin data:', error);
            }
        }

        async function loadPendingUsers() {
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/pending-users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const pending = await response.json();
                
                const container = document.getElementById('pendingUsersList');
                if (pending.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ingen ventende registreringer</p>';
                    return;
                }
                
                container.innerHTML = pending.map(user => `
                    <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 10px 0;">${user.name}</h4>
                                <p style="margin: 5px 0; color: #666;">üìß ${user.email}</p>
                                <p style="margin: 5px 0; color: #666;">üíº ${user.position || 'Ikke angivet'}</p>
                                <p style="margin: 5px 0; color: #666;">üè¢ ${user.department || 'Ikke angivet'}</p>
                                <p style="margin: 5px 0; color: #999; font-size: 12px;">Anmodet: ${new Date(user.created_at).toLocaleString('da-DK')}</p>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="approveUser(${user.id})" style="padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    ‚úÖ Godkend
                                </button>
                                <button onclick="rejectUser(${user.id})" style="padding: 8px 16px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    ‚ùå Afvis
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                alert('Fejl ved indl√¶sning af ventende brugere: ' + error.message);
            }
        }

        async function approveUser(userId) {
            if (!confirm('Godkend denne bruger?')) return;
            
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch(`https://flowfactory-backend-production.up.railway.app/api/admin/approve-user/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Godkendelse fejlede');
                
                alert('‚úÖ Bruger godkendt!');
                loadPendingUsers();
                loadAdminData();
            } catch (error) {
                alert('Fejl: ' + error.message);
            }
        }

        async function rejectUser(userId) {
            if (!confirm('Afvis denne bruger?')) return;
            
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch(`https://flowfactory-backend-production.up.railway.app/api/admin/reject-user/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Afvisning fejlede');
                
                alert('‚ùå Bruger afvist');
                loadPendingUsers();
                loadAdminData();
            } catch (error) {
                alert('Fejl: ' + error.message);
            }
        }

        async function sendEmailInvitation() {
            const email = prompt('Indtast email adresse:');
            if (!email || !email.trim()) return;
            
            const name = prompt('Indtast navn (valgfrit):');
            
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/send-invitation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        email: email.trim(),
                        name: name ? name.trim() : null
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to send invitation');
                }
                
                const result = await response.json();
                
                alert(`‚úÖ Email invitation sendt til ${email}!\n\nInvite kode: ${result.code}\n\nEmailen er sendt og koden er gyldig i 7 dage.`);
                
                loadInviteCodes();
                loadAdminData();
            } catch (error) {
                alert('Fejl ved sending: ' + error.message);
            }
        }

        async function generateInviteCode() {
            const days = prompt('Antal dage koden skal v√¶re gyldig:', '7');
            if (!days) return;
            
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/generate-invite', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ daysValid: parseInt(days) })
                });
                
                const invite = await response.json();
                
                alert(`‚úÖ Invite kode genereret!\n\nKode: ${invite.code}\n\nDel denne kode med nye brugere. Den udl√∏ber: ${new Date(invite.expires_at).toLocaleString('da-DK')}`);
                
                loadInviteCodes();
                loadAdminData();
            } catch (error) {
                alert('Fejl ved generering: ' + error.message);
            }
        }

        async function loadInviteCodes() {
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/invite-codes', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const codes = await response.json();
                
                const container = document.getElementById('inviteCodesList');
                if (codes.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ingen invite koder endnu</p>';
                    return;
                }
                
                container.innerHTML = codes.map(code => {
                    const isExpired = new Date(code.expires_at) < new Date();
                    const isUsed = code.used_by !== null;
                    const status = isUsed ? '‚úÖ Brugt' : isExpired ? '‚è∞ Udl√∏bet' : 'üü¢ Aktiv';
                    const statusColor = isUsed ? '#4caf50' : isExpired ? '#999' : '#2196f3';
                    
                    return `
                        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0 0 10px 0; font-family: monospace; font-size: 18px;">${code.code}</h4>
                                    <p style="margin: 5px 0; color: ${statusColor}; font-weight: bold;">${status}</p>
                                    <p style="margin: 5px 0; color: #666;">Oprettet af: ${code.created_by_name}</p>
                                    <p style="margin: 5px 0; color: #666;">Udl√∏ber: ${new Date(code.expires_at).toLocaleString('da-DK')}</p>
                                    ${isUsed ? `<p style="margin: 5px 0; color: #666;">Brugt af: ${code.used_by_name}</p>` : ''}
                                </div>
                                ${!isUsed ? `
                                    <button onclick="deleteInviteCode(${code.id})" style="padding: 8px 16px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                        üóëÔ∏è Slet
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                alert('Fejl ved indl√¶sning af invite koder: ' + error.message);
            }
        }

        async function deleteInviteCode(codeId) {
            if (!confirm('Slet denne invite kode?')) return;
            
            try {
                const token = sessionStorage.getItem('token');
                await fetch(`https://flowfactory-backend-production.up.railway.app/api/admin/invite-codes/${codeId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                alert('‚úÖ Invite kode slettet');
                loadInviteCodes();
                loadAdminData();
            } catch (error) {
                alert('Fejl: ' + error.message);
            }
        }

        async function loadAllUsers() {
            try {
                const token = sessionStorage.getItem('token');
                const response = await fetch('https://flowfactory-backend-production.up.railway.app/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const users = await response.json();
                
                const container = document.getElementById('allUsersList');
                container.innerHTML = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e0e0e0;">Navn</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e0e0e0;">Email</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e0e0e0;">Stilling</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e0e0e0;">Afdeling</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e0e0e0;">Admin</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e0e0e0;">Handlinger</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr style="border-bottom: 1px solid #e0e0e0;">
                                    <td style="padding: 10px;">${user.name}</td>
                                    <td style="padding: 10px;">${user.email}</td>
                                    <td style="padding: 10px;">${user.position || '-'}</td>
                                    <td style="padding: 10px;">${user.department || '-'}</td>
                                    <td style="padding: 10px; text-align: center;">${user.is_admin ? 'üõ°Ô∏è Ja' : '-'}</td>
                                    <td style="padding: 10px; text-align: center;">
                                        ${user.id !== window.currentUser.id ? `
                                            ${!user.is_admin ? `
                                                <button onclick="makeAdmin(${user.id})" style="padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                                    G√∏r til admin
                                                </button>
                                            ` : `
                                                <button onclick="removeAdmin(${user.id})" style="padding: 5px 10px; background: #f44336; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                                    Fjern admin
                                                </button>
                                            `}
                                        ` : '<em>Dig selv</em>'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
            } catch (error) {
                alert('Fejl ved indl√¶sning af brugere: ' + error.message);
            }
        }

        async function makeAdmin(userId) {
            if (!confirm('G√∏r denne bruger til administrator?')) return;
            
            try {
                const token = sessionStorage.getItem('token');
                await fetch(`https://flowfactory-backend-production.up.railway.app/api/admin/make-admin/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                alert('‚úÖ Bruger er nu administrator');
                loadAllUsers();
            } catch (error) {
                alert('Fejl: ' + error.message);
            }
        }

        async function removeAdmin(userId) {
            if (!confirm('Fjern admin rettigheder fra denne bruger?')) return;
            
            try {
                const token = sessionStorage.getItem('token');
                await fetch(`https://flowfactory-backend-production.up.railway.app/api/admin/remove-admin/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                alert('‚úÖ Admin rettigheder fjernet');
                loadAllUsers();
            } catch (error) {
                alert('Fejl: ' + error.message);
            }
        }

        // Load admin data n√•r siden indl√¶ses
        window.addEventListener('load', function() {
            if (window.currentUser && window.currentUser.is_admin) {
                loadAdminData();
            }
        });
    </script>
</body>
</html>
